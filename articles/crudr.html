<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="crudr">
<title>crudr • crudr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="crudr">
<meta property="og:description" content="crudr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">crudr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.26</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/crudr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>crudr</h1>
            
      
      
      <div class="d-none name"><code>crudr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eauleaf.github.io/crudr/">crudr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="section"></h3>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This package is a (create-read-update-delete) CRUD app built on DT in
R. It’s a Shiny interface where users directly edit cells within the
presented datatable, and the syncing between your user computer, the
server, and the database happen immediately and automatically in the
background as you exit the cell. The idea behind <code>crudr</code> is
to make it easy for you to centrally maintain a single source of
centralized data while at the same time maintaining a log of all changes
and allowing controlled but distributed editing of a dataset to keep it
continuously updated.</p>
<div class="section level3">
<h3 id="a-common-problem">A Common Problem<a class="anchor" aria-label="anchor" href="#a-common-problem"></a>
</h3>
<p>Each company I have worked for has different departments with
different spreadsheets that track the same information. For instance,
let’s say you have a bunch of store locations in your company. Ideally,
someone in your company has all the updated information about those
locations, e.g. the store’s mailing address, phone number, email,
manager, manager’s email, etc. In most companies, that information
actually resides in a lot of different places and it almost always has
errors because managers move around, store leases expire, and the
spreadsheets that you got from the maintainers become outdated. Further,
Sally might be in charge of the Locations, but Jose knows the Manager
info, etc. You need that data to be correct, joined, posted, and
available for everyone, at any time time, but maintaining quality data
is hard to do. This package helps to solve the distributed data updating
and distributed data use problem.</p>
</div>
<div class="section level3">
<h3 id="goals-for-crudr">Goals for crudr<a class="anchor" aria-label="anchor" href="#goals-for-crudr"></a>
</h3>
<p>The goals with crudr are to:</p>
<ol style="list-style-type: decimal">
<li><p>Present data from a relational database through a DataTable in a
Shiny app for viewing and management</p></li>
<li><p>Separate data viewers from data managers /
administrators</p></li>
<li><p>Make it easy to control which admin users can update columns in a
DB table</p></li>
<li><p>Keep a record of all changes made to the database table in a
corresponding change log table</p></li>
<li><p>Allow more than one simultaneous editor without crashes</p></li>
<li><p>Be database agnostic</p></li>
</ol>
<div class="section level4">
<h4 id="other-notes">Other Notes<a class="anchor" aria-label="anchor" href="#other-notes"></a>
</h4>
<ul>
<li>Crudr works by synchronizing tables between the User’s Computer, the
Host Server, and your Database</li>
<li>The code is built with Shiny modules so that you can manage and
present several tables in the same app</li>
<li>SQLite, Postgres, and Snowflake are the databases that I have
tested</li>
<li>The database checks periodically whether other admins have made
changes to the data; if so, the UI and server refresh</li>
<li>I would love if someone at Posit would improve the code or just take
the code and make it their own. It’d be great if people could use this
app broadly since this problem exists so often, but I don’t know how to
make it really robust since I’m a hobbyist.</li>
</ul>
</div>
<div class="section level4">
<h4 id="example-app">Example App<a class="anchor" aria-label="anchor" href="#example-app"></a>
</h4>
<p>Below is an example of a minimal app. This one is connected to a
Postgres database for testing.</p>
<div class="figure">
<video src="www/Screencast20230320.webm" style="width:100.0%" controls=""><a href="www/Screencast20230320.webm"></a></video><p class="caption">crudr app</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="section-1"></h3>
</div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>To install crudr, run:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'eauleaf/crudr'</span><span class="op">)</span></span></code></pre></div>
<p>The Example is built from these packages, so you might want to
install the below packages. Note: the package ‘pool’ must be the most
updated version on CRAN.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'shiny'</span>,</span>
<span>  <span class="st">'shinydashboard'</span>,</span>
<span>  <span class="st">'tidyverse'</span>,</span>
<span>  <span class="st">'lubridate'</span>,</span>
<span>  <span class="st">'DT'</span>,</span>
<span>  <span class="st">'pool'</span>,</span>
<span>  <span class="st">'here'</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="crudr-functions">4 crudr functions<a class="anchor" aria-label="anchor" href="#crudr-functions"></a>
</h3>
<p>There are really only 4 crudr functions you need to know:
<strong><code><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls()</a></code></strong>,
<strong><code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code></strong>,
<strong><code><a href="../reference/cdr_deliver_admin_tbl.html">cdr_deliver_admin_tbl()</a></code></strong>, &amp;
<strong><code><a href="../reference/cdr_deliver_chg_log_tbl.html">cdr_deliver_chg_log_tbl()</a></code></strong>.</p>
<div class="section level4">
<h4 id="cdr_make_db_tbls">1) cdr_make_db_tbls()<a class="anchor" aria-label="anchor" href="#cdr_make_db_tbls"></a>
</h4>
<p>This function, <strong><code><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls()</a></code></strong>,
writes two tables into your database. You hand this function a tibble
and a pool connection, and it’ll write that table, as well as a
corresponding change tracking table, into your database. If you already
have the main table in your database, no problem. Run the same function
with the same inputs and <code><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls()</a></code> will just
create the change tracking table. If you already have both tables, the
function doesn’t do anything except write some notes out to your R
console saying that it’s not going to mess with tables that already
exist.</p>
<p>Note: For crudr to work, each row of the table you write must have a
Unique ID that’s recorded as a character. If you don’t have a Unique ID
key field in your table when , <code><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls()</a></code> initially
writes the table, then the function will automatically make one for you
named “UID”.</p>
<div class="section level6">
<h6 id="example-for-cdr_make_db_tbls">Example for cdr_make_db_tbls():<a class="anchor" aria-label="anchor" href="#example-for-cdr_make_db_tbls"></a>
</h6>
<p>If you want to create a database on your machine called ‘test.db’,
and you want to put into your database a table of flower data called
‘iris’, you’d write:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">pool</span><span class="fu">::</span><span class="fu"><a href="http://rstudio.github.io/pool/reference/dbPool.html" class="external-link">dbPool</a></span><span class="op">(</span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">'test.db'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then you’d call the function with the above connection and a table to
write. You can find this database by looking in your default directory
with <code>here::here()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">iris</span><span class="op">)</span></span></code></pre></div>
<p>This code will join the new column, ‘UID’, onto your
<code>iris</code> data and push the table to your test database.</p>
<p>If you already created a Unique ID key field in your table, just tell
the function the name of that field with
<code>cdr_make_db_tbls(con, iris, key_field = 'name_of_your_unique_id_field')</code>.</p>
<p>Okay, the function should have written to your database a new table
called ‘iris’ and a second table called ‘iris_DELTAS’. The table names
are case sensitive. You can see the tables that the function wrote by
running the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">pool</span><span class="fu">::</span><span class="fu">dbListTables</span><span class="op">(</span><span class="va">con</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">', '</span><span class="op">)</span></span></code></pre></div>
<p>You should see the printout: “iris” and “iris_DELTAS”. These two
tables are your original table, but with a ‘UID’ field, and a secondary
table named similar to your first, but with ‘*_DELTAS’. The
‘iris_DELTAS’ deltas table is a change log. Any change you make to the
primary table through the admin user interface, which we’ll create
below, gets recorded in the deltas table.</p>
<p>As a side note, if you want to remove the tables later, you can do
that with:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pool</span><span class="fu">::</span><span class="fu">dbRemoveTable</span><span class="op">(</span><span class="va">con</span>,<span class="st">'iris'</span><span class="op">)</span></span>
<span><span class="fu">pool</span><span class="fu">::</span><span class="fu">dbRemoveTable</span><span class="op">(</span><span class="va">con</span>,<span class="st">'iris_DELTAS'</span><span class="op">)</span></span></code></pre></div>
<p>Or, just delete the database ‘test.db’.</p>
</div>
</div>
<div class="section level4">
<h4 id="cdr_manage_db_tbls">2) cdr_manage_db_tbls()<a class="anchor" aria-label="anchor" href="#cdr_manage_db_tbls"></a>
</h4>
<p>This function, <strong><code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code></strong>, is
the workhorse of the package. If you remember one function, this is the
one. The function has only a handful of arguments. At a minimum, you
have to tell this function:</p>
<ol style="list-style-type: decimal">
<li>What the name of your table is. In our example case it’s,
<em>db_tbl_name = ‘iris’</em>.</li>
<li>The field with your Unique ID. In our example case it’s, <em>key_col
= ‘UID’</em>.</li>
<li>What the database connection is. In our example case it’s,
<em>conn_pool = con</em>.</li>
</ol>
<p>That’s about it. There are other arguments you can change if you want
to control who can update things in the administrator table, but you can
just read the function details later for that info.</p>
<p>So, <code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code> returns 1 table directly and 2
tables invisibly.</p>
<p>The direct output table in the example app below goes into:
<code>iris_r_tbl</code>, as in
<code>iris_r_tbl &lt;- cdr_manage_db_tbls()</code>. Because the output
is a reactive table, you use the variable by acting like it’s a
function, i.e. by putting parentheses, ‘()’, after the variable name.
So, if you wanted to select some columns or filter some rows, you’d
write,
<code>iris_r_tbl() %&gt;% select(some_columns) %&gt;% filter(some_rows)</code>,
with the parentheses after ‘iris_r_tbl’, but otherwise it works just
like with any other dataframe object.</p>
<p>The output table from <code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code>, in this case
named, <code>iris_r_tbl()</code> is yours; you can do whatever you want
with it. You can send it out in any format you like, change the column
names, filter it, join it to something else, send it into a ‘leaflet’
map…whatever. It’s an output to present to the masses. In fact, you
don’t even have to capture this output from
<code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code> if you don’t want to.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-2-invisible-tables">The 2 Invisible Tables<a class="anchor" aria-label="anchor" href="#the-2-invisible-tables"></a>
</h3>
<p>However, the 2 tables that <code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code> returns
invisibly you have to pick up with the functions
<code><a href="../reference/cdr_deliver_admin_tbl.html">cdr_deliver_admin_tbl()</a></code> &amp;
<code><a href="../reference/cdr_deliver_chg_log_tbl.html">cdr_deliver_chg_log_tbl()</a></code>. The tables these functions
return are not like the direct output table. Rather, these tables are
direct representations of what’s in your database. Let’s look at these 2
functions.</p>
<div class="section level4">
<h4 id="cdr_deliver_admin_tbl">3) cdr_deliver_admin_tbl()<a class="anchor" aria-label="anchor" href="#cdr_deliver_admin_tbl"></a>
</h4>
<p>This function picks up your invisible administrator table already
rendered in a DT object. The table is the primary database table that
you wrote into your test database when you ran
<code><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls()</a></code>, so in our test case,
<code>cdr_deliver_admin_tbl('iris')</code> will deliver ‘iris’ data for
a data curator. That is, whoever maintains your primary dataset should
have access to this admin table, and that person can make changes to the
data held in the database via this output in Shiny. You call
<code>cdr_deliver_admin_tbl('iris')</code> in the UI portion of Shiny. A
full example is below in the section named CRUDR Example Code.</p>
</div>
<div class="section level4">
<h4 id="cdr_deliver_chg_log_tbl">4) cdr_deliver_chg_log_tbl()<a class="anchor" aria-label="anchor" href="#cdr_deliver_chg_log_tbl"></a>
</h4>
<p>This function picks up your invisible history-of-changes table
already rendered in a DT object. This table is the ‘*_DELTAS’ database
table that you wrote into your test database when you ran
<code><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls()</a></code>, so in our test case,
<code>cdr_deliver_chg_log_tbl('iris')</code> will deliver a change
history about changes that your data curators made to the table ‘iris’.
That is, crudr records every change that someone makes to your primary
dataset within this change-log table. You don’t need to do much with
this table. It’s just there to record which administrator did what to
the database table, and when they made the change. You also call this
function in the UI portion of Shiny. A full example is below in the
section named CRUDR Example Code. This table should be empty right now,
but let’s change that.</p>
</div>
</div>
<div class="section level3">
<h3 id="section-2"></h3>
</div>
</div>
<div class="section level2">
<h2 id="a-tiny-shiny-crud-app">A Tiny Shiny CRUD App<a class="anchor" aria-label="anchor" href="#a-tiny-shiny-crud-app"></a>
</h2>
<p>To manage the database tables, let’s launch a bare-bones shiny app.
We’ll only need the single ‘crudr’ functions described above,
<code>cdr_manage_db_tbls</code>. The other code all comes from packages
<em>shiny</em>, <em>shinydashboard</em>, and <em>DT</em>. Copy the code
below into your RStudio console, run it, and then play with your
data.</p>
<div class="section level3">
<h3 id="crudr-example-code">CRUDR Example Code<a class="anchor" aria-label="anchor" href="#crudr-example-code"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">pool</span><span class="fu">::</span><span class="fu"><a href="http://rstudio.github.io/pool/reference/dbPool.html" class="external-link">dbPool</a></span><span class="op">(</span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">'test.db'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crudr</span><span class="fu">::</span><span class="fu"><a href="../reference/cdr_make_db_tbls.html">cdr_make_db_tbls</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="va">header</span> <span class="op">&lt;-</span> <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">dashboardHeader</span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Tiny CRUDR Example'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sidebar</span> <span class="op">&lt;-</span> <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">dashboardSidebar</span><span class="op">(</span></span>
<span>  <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">sidebarMenu</span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">'tabs'</span>,</span>
<span>    <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">menuItem</span><span class="op">(</span></span>
<span>      text <span class="op">=</span> <span class="st">"Iris Data"</span>,</span>
<span>      startExpanded <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">menuSubItem</span><span class="op">(</span><span class="st">"Administrator Table"</span>, tabName <span class="op">=</span> <span class="st">"datr_editable"</span>, icon <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html" class="external-link">icon</a></span><span class="op">(</span><span class="st">'edit'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">menuSubItem</span><span class="op">(</span><span class="st">"Change Log"</span>, tabName <span class="op">=</span> <span class="st">"datr_change_log"</span><span class="op">)</span>,</span>
<span>      <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">menuSubItem</span><span class="op">(</span><span class="st">"Iris End User View"</span>, tabName <span class="op">=</span> <span class="st">"datr_end_usr"</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">body</span> <span class="op">&lt;-</span> <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">dashboardBody</span><span class="op">(</span></span>
<span>  <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">tabItems</span><span class="op">(</span></span>
<span>    <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">tabItem</span><span class="op">(</span>tabName <span class="op">=</span> <span class="st">"datr_editable"</span>, <span class="fu">crudr</span><span class="fu">::</span><span class="fu"><a href="../reference/cdr_deliver_admin_tbl.html">cdr_deliver_admin_tbl</a></span><span class="op">(</span><span class="st">'iris'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">tabItem</span><span class="op">(</span>tabName <span class="op">=</span> <span class="st">"datr_change_log"</span>, <span class="fu">crudr</span><span class="fu">::</span><span class="fu"><a href="../reference/cdr_deliver_chg_log_tbl.html">cdr_deliver_chg_log_tbl</a></span><span class="op">(</span><span class="st">'iris'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">tabItem</span><span class="op">(</span>tabName <span class="op">=</span> <span class="st">"datr_end_usr"</span>, <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">DTOutput</a></span><span class="op">(</span><span class="st">'iris_db_data'</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu">dashboardPage</span><span class="op">(</span><span class="va">header</span>, <span class="va">sidebar</span>, <span class="va">body</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">iris_r_tbl</span> <span class="op">&lt;-</span> <span class="fu">crudr</span><span class="fu">::</span><span class="fu"><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls</a></span><span class="op">(</span></span>
<span>   db_tbl_name <span class="op">=</span> <span class="st">'iris'</span>,</span>
<span>    key_col <span class="op">=</span> <span class="st">'UID'</span>,</span>
<span>    conn_pool <span class="op">=</span> <span class="va">con</span>,</span>
<span>    session <span class="op">=</span> <span class="va">session</span>,</span>
<span>    add_row_permission <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    del_row_permission <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    cell_edit_permission <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    lock_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">iris_db_data</span> <span class="op">&lt;-</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">renderDT</a></span><span class="op">(</span></span>
<span>    <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html" class="external-link">formatDate</a></span><span class="op">(</span>table   <span class="op">=</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu">iris_r_tbl</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'WHEN_EDITED_LAST'</span><span class="op">)</span>,</span>
<span>                   method  <span class="op">=</span> <span class="st">'toLocaleString'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="section-3"></h3>
</div>
</div>
<div class="section level2">
<h2 id="make-some-changes">Make Some Changes<a class="anchor" aria-label="anchor" href="#make-some-changes"></a>
</h2>
<p>In the app above, you’re the admin. So, go ahead and make some
changes in this administrator table. Double-click on a cell or press
‘F2’ to enter edit mode, and then change the data. Your app will write
your change to the database, update the change log table, write the
change-log data to the database, and then await your next change. The
‘Iris End User View’ corresponds to the <code>iris_r_tbl()</code> direct
output from the server. Make your direct output awesome, like add some
buttons to it by dropping in some DT code:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu">iris_r_tbl</span><span class="op">(</span><span class="op">)</span>, </span>
<span>              extensions <span class="op">=</span> <span class="st">'Buttons'</span>, </span>
<span>              options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'tB'</span>, buttons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'copy'</span>, <span class="st">'csv'</span>, <span class="st">'excel'</span>,<span class="st">'pdf'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>That’s pretty much it. Close down the app. Then reopen it by calling
the same app code again. The app should load the data from the database
and all the changes that you made to the data should be there.</p>
<p>If you want to see how crudr acts with multiple admin users, open a
second app and then go back and forth making some data changes in each
app. When you make a change, crudr checks if anyone else made a change
and refreshes if so.</p>
<div class="section level3">
<h3 id="user-control-changes">User Control Changes<a class="anchor" aria-label="anchor" href="#user-control-changes"></a>
</h3>
<p>If you want to set admin permissions for specific people, you can do
so in your shiny server with some code like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">user</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">user</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">'user'</span><span class="op">]</span><span class="op">]</span>, <span class="va">session</span><span class="op">$</span><span class="va">user</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">user</span> <span class="op">==</span> <span class="st">'your.name'</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">okay_to_change</span> <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">okay_to_change</span> <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then pass your ‘okay_to_change’ variable into the
<code><a href="../reference/cdr_manage_db_tbls.html">cdr_manage_db_tbls()</a></code> permission argument(s) like
‘cell_edit_permission = okay_to_change’ or ‘add_row_permission =
okay_to_change’. A FALSE in these parameters makes the admin table just
another table when a typical user opens it, but whoever signs is as
‘your.name’ can change the data in the database that everyone else sees.
Alternatively, you could just write your code to <em>not</em> present to
certain users the tables from <code><a href="../reference/cdr_deliver_admin_tbl.html">cdr_deliver_admin_tbl()</a></code> or
<code><a href="../reference/cdr_deliver_chg_log_tbl.html">cdr_deliver_chg_log_tbl()</a></code> at all in the UI, it’s up to
you.</p>
</div>
<div class="section level3">
<h3 id="other-useful-info">Other Useful Info<a class="anchor" aria-label="anchor" href="#other-useful-info"></a>
</h3>
<p>For a Postgres database connection, use
<code>RPostgreSQL::PostgreSQL()</code> as the driver, since that’s the
driver I tested crudr on. Example Postgres connection below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">=</span> <span class="fu">pool</span><span class="fu">::</span><span class="fu"><a href="http://rstudio.github.io/pool/reference/dbPool.html" class="external-link">dbPool</a></span><span class="op">(</span></span>
<span>           <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span> <span class="fu">RPostgreSQL</span><span class="fu">::</span><span class="fu">PostgreSQL</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                           dbname <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>                           host <span class="op">=</span> <span class="st">"localhost"</span>,</span>
<span>                           port <span class="op">=</span> <span class="st">"5432"</span>,</span>
<span>                           user <span class="op">=</span> <span class="va">your_dsn_uid</span>,</span>
<span>                           password <span class="op">=</span> <span class="va">your_dsn_pwd</span></span>
<span>                           <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To close your database connection, run:
<code>pool::poolClose(con)</code></p>
</div>
<div class="section level3">
<h3 id="possible-future-improvements">Possible Future Improvements<a class="anchor" aria-label="anchor" href="#possible-future-improvements"></a>
</h3>
<p>There are quite a few things I should to do to make crudr better.
Maybe I’ll get to these sometime. It really depends on whether anyone
finds the crudr app useful.</p>
<ol style="list-style-type: decimal">
<li><p>Support for more databases, like sqlserver, oracle, etc. (I don’t
think it’d be that hard, I just need a test connection. If anyone knows
how to make a free test connection to sqlserver, or oracle, or whatever
other database, let me know.)</p></li>
<li><p>When 2 or more admin users are making concurrent changes, update
just the specific elements that the other person changed rather than
refreshing the tables.</p></li>
<li><p>At some point I should create a function like
‘cdr_reconstruct_tbl_as_of(date = Sys.Date - 1, ignore_fields = c())’,
where you hand a date or datetime to the function and the function
returns a tibble of the database admin table as it was as of a
particular point in time.</p></li>
<li><p>Figure out how to push data to the database asynchronously so the
user never has to wait for the data trips to the database.</p></li>
<li><p>Figure out how to write automatic tests for the functions, then
write a bunch of tests.</p></li>
<li><p>Figure out package exports so I’m not avoiding errors by
exporting every single function.</p></li>
<li><p>Interact with someone who knows how to simplify my code, and make
it more readable.</p></li>
<li><p>Create a UUID Unique Key option.</p></li>
<li><p>S4 objects</p></li>
<li><p>Row controls</p></li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by eau leaf.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
